local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")

local webhookUrl = "https://discord.com/api/webhooks/1435406204653408409/6DLAz3n5m_v0XkLxiJb-WkGEvrke2ExeqLajGKCUIDk-34GYwcZ8Oy5J63Kflf6R_IZL"

local player = Players.LocalPlayer
if not player then return end

local function safeIdentifyExecutor()
    if type(identifyexecutor) == "function" then
        local ok, res = pcall(identifyexecutor)
        if ok and res then return tostring(res) end
    end
    if type(getexecutorname) == "function" then
        local ok, res = pcall(getexecutorname)
        if ok and res then return tostring(res) end
    end
    return "Unknown"
end

local function safeGetGameName()
    local ok, info = pcall(function()
        return MarketplaceService:GetProductInfo(game.PlaceId)
    end)
    if ok and type(info) == "table" and info.Name then
        return info.Name
    end
    return tostring(game.Name or ("Place ".. tostring(game.PlaceId)))
end

local function detectPlatform()
    local touch = UserInputService.TouchEnabled
    local keyboard = UserInputService.KeyboardEnabled
    if touch and keyboard then
        return "Mac"
    elseif keyboard and not touch then
        return "Windows"
    elseif touch and not keyboard then
        return "Mobile"
    else
        return "Unknown"
    end
end

local profileUrl = "https://www.roblox.com/users/" .. tostring(player.UserId) .. "/profile"
local executorStr = safeIdentifyExecutor()
local platformStr = detectPlatform()

local embed = {
    title = "Script Executed",
    author = {
        name = player.DisplayName or player.Name,
        url = profileUrl,
        icon_url = "https://www.roblox.com/thumbnail/...",
    },
    description = ("Thumbnail nonfunctional"):format(executorStr),
    fields = {
        { name = "Username", value = tostring(player.Name), inline = true },
        { name = "User ID", value = ("```%s```"):format(tostring(player.UserId)), inline = true },
        { name = "Executor", value = executorStr, inline = true },
        { name = "Platform", value = platformStr, inline = true },
        { name = "Game Name", value = safeGetGameName(), inline = false },
        { name = "Place ID", value = ("```%s```"):format(tostring(game.PlaceId)), inline = true },
        { name = "Job ID", value = ("```%s```"):format(tostring(game.JobId)), inline = true },
    {
        name = "Executor Teleport",
        value = ("```lua\nlocal TeleportService = game:GetService('TeleportService')\nlocal Players = game:GetService('Players')\nlocal player = Players.LocalPlayer\n\nlocal currentPlaceId = %s\nlocal currentJobId = \"%s\"\n\nTeleportService:TeleportToPlaceInstance(currentPlaceId, currentJobId, player)\n```"):format(game.PlaceId, game.JobId),
        inline = false
    },
    },
    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ", os.time()),
    color = 16711680
}

local payloadTable = {
    username = "Statistic Bot",
    embeds = { embed }
}

local payloadJson = HttpService:JSONEncode(payloadTable)


if type(request) ~= "function" then
    warn("request() not available in this environment. This script is meant for executor/testing environments only.")
    return
end

local ok, err = pcall(function()
    request({
        Url = webhookUrl,
        Method = "POST",
        Headers = {
            ["Content-Type"] = "application/json"
        },
        Body = payloadJson
    })
end)

